version: "3.8"

x-bot-config: &bot-config
  build: .
  restart: always
  shm_size: "2gb"
  env_file: .env
  deploy:
    resources:
      limits:
        memory: 600M
      reservations:
        memory: 200M

services:
  # ===================== REDIS SERVICE =====================
  redis:
    image: redis:alpine
    container_name: sheypoor-redis
    restart: always
    ports:
      - "6379:6379"
    # ports:           <-- Ø§ÛŒÙ† Ø±Ø§ Ú©Ø§Ù…Ù†Øª Ú©Ø±Ø¯Ù… ØªØ§ Ø§Ø±ÙˆØ± Port already in use Ù†Ø¯Ù‡Ø¯

  # ===================== SHEYPOOR BOTS =====================

  # 1. MAZANDARAN
  sheypoor-mazandaran:
    <<: *bot-config
    container_name: shi-mazandaran
    command: node Sheypoor-MZNDRN/src/index.js
    environment:
      - PORT=4000
      - BOT_TOKEN=${TOKEN_MAZANDARAN}
      - REDIS_HOST=redis # ðŸ‘ˆðŸ‘ˆðŸ‘ˆ Ø§ÛŒÙ† Ø®Ø· Ø­ÛŒØ§ØªÛŒ Ø§Ø³Øª (Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯)

  # 2. QOM - ARAK
  sheypoor-qom-arak:
    <<: *bot-config
    container_name: shi-qom-arak
    command: node Sheypoor-QOM-ARAK/src/index.js
    environment:
      - PORT=4001
      - BOT_TOKEN=${TOKEN_QOM_ARAK}
      - REDIS_HOST=redis # ðŸ‘ˆ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯

  # 3. SHIRAZ - ISFAHAN
  sheypoor-shiraz-isfahan:
    <<: *bot-config
    container_name: shi-shiraz-isfahan
    command: node Sheypoor-SHZ-ISFHN/src/index.js
    environment:
      - PORT=4002
      - BOT_TOKEN=${TOKEN_SHIRAZ_ISFAHAN}
      - REDIS_HOST=redis # ðŸ‘ˆ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯

  # 4. TEHRAN - SEMNAN
  sheypoor-tehran-semnan:
    <<: *bot-config
    container_name: shi-tehran-semnan
    command: node Sheypoor-THR-SMNAN/src/index.js
    environment:
      - PORT=4003
      - BOT_TOKEN=${TOKEN_TEHRAN_SEMNAN}
      - REDIS_HOST=redis # ðŸ‘ˆ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯

  # 5. YAZD - GILAN
  sheypoor-yazd-gilan:
    <<: *bot-config
    container_name: shi-yazd-gilan
    command: node Sheypoor-YAZD-GILAN/src/index.js
    environment:
      - PORT=4004
      - BOT_TOKEN=${TOKEN_YAZD_GILAN}
      - REDIS_HOST=redis # ðŸ‘ˆ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯
